#   -----------============   LetsEncrypt SSL  ==============--------------

--- Obtaining a certificate ---

//letsencrypt.org/getting-started/

# Certbot 
https://certbot.eff.org/

# SSL --
sudo apt install software-properties-common
sudo add-apt-repository ppa:certbot/certbot-build
sudo apt update
sudo apt install python-certbot-nginx

# ssl key_gen
sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048

# create snippet for ssl 
sudo vim /etc/nginx/snippets/ssl-params.conf

	ssl_session_timeout 1d;
	ssl_session_cache shared:SSL:10m;
	ssl_session_tickets off;
	
	ssl_dhparam /etc/ssl/certs/dhparam.pem;
	
	ssl_protocols TLSv1.2 TLSv1.3;
	ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
	ssl_prefer_server_ciphers off;
	
	add_header Strict-Transport-Security "max-age=63072000" always;

# Take SSL
sudo certbot --nginx certonly

mail: @
A
Y
1 2

# nginx and SSL:
sudo vim /etc/nginx/sites-available/example.com.conf

    server {
        listen 80;
        listen [::]:80;
    
        server_name example.com www.example.com;
        return 301 https://example.com$request_uri;
    }
    
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;
    
        server_name www.example.com;
        return 301 https://example.com$request_uri;
    
        ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
        ssl_trusted_certificate /etc/letsencrypt/live/example.com/chain.pem;
    
        include snippets/ssl-params.conf;
    }
    
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;
    
        server_name example.com;
        location = /favicon.ico { access_log off; log_not_found off; }
        location /static/ {
            root /home/mrleon/workDir; 
        }

        location / {
	    proxy_pass http://127.0.0.1:8001;
	    proxy_set_header X-Forwarded-Host $server_name;    
	    proxy_set_header X-Real-IP $remote_addr;
	    add_header P3P  'CP="ALL IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT"';
	    add_header Access-Control-Allow-Origin *; 
        }
    
        ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
        ssl_trusted_certificate /etc/letsencrypt/live/example.com/chain.pem;
    
        include snippets/ssl-params.conf;
    }

# restart
sudo systemctl restart nginx

