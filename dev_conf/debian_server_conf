        ---=== Debian Server Set Up for Django Instruction ===---


-- 1 --

## New user --
adduser user_name
usermod -aG sudo user_name
su - user_name


sudo apt update 
sudo apt install -y vim mosh zsh tmux ufw htop git curl wget unzip zip gcc build-essential make


## Configure SSH:
# Base dir
sudo vim /etc/ssh/sshd_config
    AllowUsers user_name
    PermitRootLogin no
    PasswordAuthentication no

# Add ssh key --
mkdir -p /home/user_name/.ssh && touch /home/user_name/.ssh/authorized_keys

# Add youre ssh pab.key in authorized_keys
vim .ssh/authorized_keys

# Restart SSH server, change user password:
sudo service ssh restart
sudo passwd user_name


## Configure UFW --
#base dir
sudo vim /etc/default/ufw

# Allow connections
sudo ufw allow ssh  	# 22
sudo ufw allow http   	# 80
sudo ufw allow https  	# 443
sudo ufw allow 60001	# mosh 

# activation
sudo ufw enable

# Install oh-my-zsh:
sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
Configure some needed aliases:

# Change your default shell
chsh -s $(which zsh)

# Add in .zshrc
export PATH=$PATH:/home/mrleon/.python/bin

# fixed with - mosh  
sudo update-locale LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8


## Init â€” must-have packages 
sudo apt-get install -y tree redis-server zlib1g-dev libbz2-dev libreadline-dev llvm libncurses5-dev libncursesw5-dev xz-utils tk-dev liblzma-dev python3-dev python-imaging python3-lxml libxslt-dev python-libxml2 python-libxslt1 libffi-dev libssl-dev python-dev gnumeric libsqlite3-dev libpq-dev libxml2-dev libxslt1-dev libjpeg-dev libfreetype6-dev libcurl4-openssl-dev supervisor


-- 2 --

# Install Docker




-- 3 --

# Install python 3

# Check Python version!

## Build from source python 3.9,0, install with prefix to ~/.python folder:
wget https://www.python.org/ftp/python/3.9.0/Python-3.9.0.tgz 
tar xvf Python-3.* 
cd Python-3.*  
mkdir ~/.python 
./configure --enable-optimizations --prefix=/home/mrleon/.python
make -j8
sudo make altinstall

# Add path in .bashrc
export PATH=$PATH:/home/mrleon/.python/bin

## Now python3.9 in /home/www/.python/bin/python3.9. Update pip:
sudo /home/mrleon/.python/bin/python3.9 -m pip install -U pip

Ok, now we can pull our project from Git repository (or create own), create and activate Python virtual environment:

# git clone project_git
# cd project_dir
python3.9 -m venv venv
. ./env/bin/activate


-- 4 --

# Install and configure PostgreSQL 

# Install PostgreSQL 12 and configure locales.
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add - 
RELEASE=$(lsb_release -cs) 
echo "deb http://apt.postgresql.org/pub/repos/apt/ ${RELEASE}"-pgdg main | sudo tee  /etc/apt/sources.list.d/pgdg.list 
sudo apt update 
sudo apt -y install postgresql-12 

# Change postges password, create clear database named dbms_db:
sudo passwd postgres
su - postgres
export PATH=$PATH:/usr/lib/postgresql/11/bin
createdb --encoding UNICODE dbms_db --username postgres
exit

# Create dbms db user and grand privileges to him:
sudo -u postgres psql
postgres=# ...
create user user_name with password 'some_password';
ALTER USER dbms CREATEDB;
grant all privileges on database dbms_db to dbms;
\c dbms_db

GRANT ALL ON ALL TABLES IN SCHEMA public to dbms;
GRANT ALL ON ALL SEQUENCES IN SCHEMA public to dbms;
GRANT ALL ON ALL FUNCTIONS IN SCHEMA public to dbms;
CREATE EXTENSION pg_trgm;
ALTER EXTENSION pg_trgm SET SCHEMA public;
UPDATE pg_opclass SET opcdefault = true WHERE opcname='gin_trgm_ops';
\q
exit

# Now we can test connection. Create ~/.pgpass with login and password to db for fast connect:
vim ~/.pgpass
	localhost:5432:dbms_db:dbms:some_password
chmod 600 ~/.pgpass
psql -h localhost -U dbms dbms_db

# Run SQL dump, if you have:
psql -h localhost dbms_db dbms  < dump.sql
